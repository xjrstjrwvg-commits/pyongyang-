<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>極・世界しりとり探索</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.7); border: 1px solid #334155; backdrop-filter: blur(12px); }
        input { background: #0f172a; border: 1px solid #475569; color: white; border-radius: 12px; padding: 10px; font-size: 14px; }
        .btn-glow { background: linear-gradient(135deg, #2563eb, #7c3aed); box-shadow: 0 0 20px rgba(37, 99, 235, 0.4); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-6">
        <header class="flex justify-between items-center border-b border-blue-900/50 pb-4">
            <h1 class="text-3xl font-black italic tracking-tighter text-blue-500">ULTRA WORLD ENGINE</h1>
            <span class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">Master Edition</span>
        </header>

        <div class="glass p-8 rounded-[32px] grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Col 1: Word & Characters -->
            <div class="space-y-4">
                <h3 class="text-xs font-bold text-blue-400 uppercase tracking-widest">Entry Settings</h3>
                <input id="sw" placeholder="開始単語 (任意)" class="w-full">
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="text-[9px] text-slate-500 block mb-1">開始字</label>
                        <input id="sc" placeholder="始" class="w-full text-center">
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-500 block mb-1">必須字</label>
                        <input id="mc" placeholder="必" class="w-full text-center">
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-500 block mb-1">終了字</label>
                        <input id="ec" placeholder="終" class="w-full text-center">
                    </div>
                </div>
            </div>

            <!-- Col 2: Logic & Depth -->
            <div class="space-y-4">
                <h3 class="text-xs font-bold text-purple-400 uppercase tracking-widest">Search Logic</h3>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="text-[9px] text-slate-500 block mb-1">単語数</label>
                        <input type="number" id="ml" value="5" class="w-full text-center">
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-500 block mb-1">位置ずらし</label>
                        <input type="number" id="ps" value="0" class="w-full text-center">
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-500 block mb-1">環状ずらし</label>
                        <input type="number" id="ks" value="0" class="w-full text-center">
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-1 pt-1 text-[11px]">
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="conj"> 共役排除</label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="rt"> 牛耕(重複許可)</label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="lo"> 必須字 各1回</label>
                </div>
            </div>

            <!-- Col 3: Data & Action -->
            <div class="flex flex-col space-y-4">
                <h3 class="text-xs font-bold text-green-400 uppercase tracking-widest">Data Source</h3>
                <div class="flex gap-4 text-xs">
                    <label class="flex items-center gap-2"><input type="checkbox" name="cat" value="country" checked> 国名</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="cat" value="capital"> 首都</label>
                </div>
                <button onclick="run()" id="btn" class="flex-grow btn-glow text-white font-black rounded-2xl transition-all active:scale-95 text-lg">EXPLORE</button>
            </div>
        </div>

        <div id="res" class="grid grid-cols-1 gap-3 pb-20"></div>
    </div>

    <script>
        async function run(){
            const btn=document.getElementById('btn');
            const resDiv=document.getElementById('res');
            btn.innerText="COMPUTING..."; btn.disabled=true;
            resDiv.innerHTML="";

            const cats = Array.from(document.querySelectorAll('input[name="cat"]:checked')).map(c => c.value);

            const r=await fetch('/search',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    start_word:document.getElementById('sw').value,
                    start_char:document.getElementById('sc').value,
                    must_char:document.getElementById('mc').value,
                    end_char:document.getElementById('ec').value,
                    max_len:document.getElementById('ml').value,
                    pos_shift:document.getElementById('ps').value,
                    kana_shift:document.getElementById('ks').value,
                    exclude_conjugates:document.getElementById('conj').checked,
                    round_trip:document.getElementById('rt').checked,
                    limit_one:document.getElementById('lo').checked,
                    categories: cats
                })
            });
            const d=await r.json();
            btn.innerText="EXPLORE"; btn.disabled=false;
            
            resDiv.innerHTML = d.count ? d.routes.map((rt, i)=>`
                <div class="glass p-4 rounded-2xl border-l-4 border-blue-500 animate-in fade-in slide-in-from-bottom-2">
                    <div class="text-[9px] text-blue-400 mb-2 font-mono">PATH #${String(i+1).padStart(3,'0')} | ${rt.length} WORDS</div>
                    <div class="overflow-x-auto pb-1 text-sm font-bold whitespace-nowrap scrollbar-hide">
                        ${rt.join(' <span class="text-blue-500 mx-1">→</span> ')}
                    </div>
                </div>
            `).join('') : '<p class="text-center text-slate-600 font-bold py-10 italic">No Routes Found</p>';
        }
    </script>
</body>
</html>
