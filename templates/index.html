<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>極・世界しりとり探索</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.7); border: 1px solid #334155; backdrop-filter: blur(12px); }
        input, select { background: #0f172a; border: 1px solid #475569; color: white; border-radius: 12px; padding: 10px; }
        .btn-primary { background: linear-gradient(135deg, #2563eb, #7c3aed); }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto space-y-6">
        <header class="flex justify-between items-center border-b border-blue-900/50 pb-4">
            <h1 class="text-3xl font-black italic text-blue-500 tracking-tighter">ULTRA WORLD ENGINE</h1>
            <div class="flex gap-4 items-center">
                <label class="text-[10px] uppercase text-slate-500 font-bold">Sort By:</label>
                <select id="sort_type" class="text-[10px] p-1 h-8">
                    <option value="kana">50音順</option>
                    <option value="length">合計文字数順</option>
                </select>
            </div>
        </header>

        <div class="glass p-8 rounded-[32px] grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="space-y-4">
                <input id="sw" placeholder="開始単語" class="w-full">
                <div class="grid grid-cols-3 gap-2">
                    <input id="sc" placeholder="開始字" class="text-center">
                    <input id="mc" placeholder="必須字" class="text-center">
                    <input id="ec" placeholder="終了字" class="text-center">
                </div>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500 block mb-1">長さ</label><input type="number" id="ml" value="5" class="w-full text-center"></div>
                    <div><label class="text-[9px] text-slate-500 block mb-1">物理位置</label><input type="number" id="ps" value="0" class="w-full text-center"></div>
                    <div><label class="text-[9px] text-slate-500 block mb-1">環状ずらし</label><input type="number" id="ks" value="0" class="w-full text-center"></div>
                </div>
                <div class="flex gap-4 text-[10px] pt-1">
                    <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" id="conj"> 共役排除</label>
                    <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" id="rt"> 重複許可</label>
                </div>
            </div>

            <div class="flex flex-col space-y-4">
                <div class="flex gap-4 text-xs font-bold">
                    <label><input type="checkbox" name="cat" value="country" checked> 国名のみ</label>
                    <label><input type="checkbox" name="cat" value="capital"> 首都も含める</label>
                </div>
                <button onclick="run()" id="btn" class="flex-grow btn-primary text-white font-black rounded-2xl active:scale-95 transition-all text-xl">EXPLORE</button>
            </div>
        </div>

        <div id="res" class="space-y-2 pb-20"></div>
    </div>

    <script>
        async function run(){
            const btn=document.getElementById('btn');
            const resDiv=document.getElementById('res');
            btn.innerText="探索中..."; btn.disabled=true;
            resDiv.innerHTML="";

            const cats = Array.from(document.querySelectorAll('input[name="cat"]:checked')).map(c => c.value);

            const r=await fetch('/search',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    start_word:document.getElementById('sw').value,
                    start_char:document.getElementById('sc').value,
                    must_char:document.getElementById('mc').value,
                    end_char:document.getElementById('ec').value,
                    max_len:document.getElementById('ml').value,
                    pos_shift:document.getElementById('ps').value,
                    kana_shift:document.getElementById('ks').value,
                    exclude_conjugates:document.getElementById('conj').checked,
                    round_trip:document.getElementById('rt').checked,
                    sort_type:document.getElementById('sort_type').value,
                    categories: cats
                })
            });
            const d=await r.json();
            btn.innerText="EXPLORE"; btn.disabled=false;
            
            resDiv.innerHTML = d.count ? d.routes.map((rt, i)=>`
                <div class="glass p-3 rounded-xl border-l-2 border-blue-500 text-sm font-bold flex justify-between items-center animate-in fade-in slide-in-from-bottom-1">
                    <div><span class="text-[9px] text-blue-400 mr-2">#${i+1}</span>${rt.join(' → ')}</div>
                    <div class="text-[9px] text-slate-500 font-mono ml-4">${rt.join('').length}文字</div>
                </div>
            `).join('') : '<p class="text-center text-slate-600 font-bold py-10 italic">No Routes Found</p>';
        }
    </script>
</body>
</html>
