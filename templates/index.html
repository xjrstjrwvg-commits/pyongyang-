<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>極・世界しりとり探索</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.7); border: 1px solid #334155; backdrop-filter: blur(12px); }
        input[type="number"], input[type="text"] { background: #0f172a; border: 1px solid #475569; color: white; border-radius: 12px; padding: 12px; }
        .route-item { border-left: 4px solid #3b82f6; transition: transform 0.2s; }
        .route-item:hover { transform: translateX(10px); }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-6xl mx-auto space-y-8">
        <header class="flex justify-between items-end border-b border-blue-500/30 pb-6">
            <div>
                <h1 class="text-5xl font-black italic tracking-tighter text-blue-500">ULTRA WORLD ENGINE</h1>
                <p class="text-slate-400 text-xs mt-2 font-mono uppercase tracking-widest">Countries & Capitals / 50 Depth / Multi-Shift</p>
            </div>
        </header>

        <div class="glass p-8 rounded-[40px] shadow-2xl grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Base -->
            <div class="space-y-5">
                <h3 class="text-blue-400 font-black text-sm uppercase tracking-wider">Entry & Target</h3>
                <input id="sw" placeholder="開始単語 (例: イスラエル)" class="w-full">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1">単語数 (2〜50)</label>
                        <input type="number" id="ml" value="10" class="w-full">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1">必須文字</label>
                        <input type="text" id="mc" placeholder="あ" class="w-full">
                    </div>
                </div>
            </div>

            <!-- Middle: Logic -->
            <div class="space-y-5">
                <h3 class="text-purple-400 font-black text-sm uppercase tracking-wider">Shift Controls</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1 font-bold">位置ずらし (物理)</label>
                        <input type="number" id="ps" value="0" class="w-full">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-1 font-bold">50音環状ずらし</label>
                        <input type="number" id="ks" value="1" class="w-full">
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-2 pt-2">
                    <label class="flex items-center gap-3 text-xs cursor-pointer"><input type="checkbox" id="ec" class="w-4 h-4"> 共役排除 (A⇄B禁止)</label>
                    <label class="flex items-center gap-3 text-xs cursor-pointer"><input type="checkbox" id="rt" class="w-4 h-4"> 牛耕モード (再利用許可)</label>
                    <label class="flex items-center gap-3 text-xs cursor-pointer"><input type="checkbox" id="lo" class="w-4 h-4"> 必須字 各1回限定</label>
                </div>
            </div>

            <!-- Right: Categories & GO -->
            <div class="flex flex-col space-y-6">
                <h3 class="text-green-400 font-black text-sm uppercase tracking-wider">Data Source</h3>
                <div class="flex gap-6 text-sm">
                    <label class="flex items-center gap-2"><input type="checkbox" name="cat" value="country" checked> 国名</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="cat" value="capital" checked> 首都</label>
                </div>
                <button onclick="run()" id="btn" class="flex-grow bg-blue-600 hover:bg-blue-500 text-white font-black rounded-3xl shadow-lg shadow-blue-900/40 transition-all active:scale-95 text-xl tracking-widest">
                    EXPLORE
                </button>
            </div>
        </div>

        <div id="res" class="grid grid-cols-1 gap-4 pb-20"></div>
    </div>

    <script>
        async function run(){
            const btn=document.getElementById('btn');
            const resDiv=document.getElementById('res');
            btn.innerText="COMPUTING..."; btn.disabled=true;
            resDiv.innerHTML="";

            const cats = Array.from(document.querySelectorAll('input[name="cat"]:checked')).map(c => c.value);

            const r=await fetch('/search',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    start_word:document.getElementById('sw').value,
                    max_len:document.getElementById('ml').value,
                    pos_shift:document.getElementById('ps').value,
                    kana_shift:document.getElementById('ks').value,
                    must_char:document.getElementById('mc').value,
                    exclude_conjugates:document.getElementById('ec').checked,
                    round_trip:document.getElementById('rt').checked,
                    limit_one:document.getElementById('lo').checked,
                    categories: cats
                })
            });
            const d=await r.json();
            btn.innerText="EXPLORE"; btn.disabled=false;
            
            if(d.count){
                resDiv.innerHTML = d.routes.map((rt, i)=>`
                    <div class="glass p-6 rounded-3xl route-item">
                        <div class="text-[10px] text-blue-400 mb-3 font-mono tracking-widest">PATH #${String(i+1).padStart(3,'0')} | ${rt.length} WORDS</div>
                        <div class="overflow-x-auto pb-2 text-sm md:text-base font-bold whitespace-nowrap scrollbar-hide">
                            ${rt.map(w => `<span class="bg-slate-800 px-3 py-1 rounded-lg">${w}</span>`).join('<span class="text-blue-500 px-2 opacity-50">→</span>')}
                        </div>
                    </div>
                `).join('');
            } else {
                resDiv.innerHTML = '<div class="text-center text-slate-500 py-20 font-black italic opacity-30 text-4xl uppercase tracking-tighter">No Routes Found</div>';
            }
        }
    </script>
</body>
</html>
